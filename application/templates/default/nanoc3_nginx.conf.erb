# nginx + nanoc3 application vhost
#
# Generated by Chef for <%= node[:fqdn] %>
# Local modifications will be overwritten.
#

<% if @domain_aliases.length > 0 %>
server {
  listen 80;
  server_name <%= @domain_aliases.join(' ') %>;
  rewrite ^(.*) http://<%= @server_name %>$1 permanent;
}

<% end %>
server {
  listen 80;
  server_name <%= @server_name %><% @server_aliases.each do |a| %><%= " #{a}" %> <% end %>;
  root <%= @docroot %>;
  error_log <%= node[:nginx][:log_dir] %>/<%= @app %>-error.log;
  access_log <%= node[:nginx][:log_dir] %>/<%= @app %>-access.log;
  error_page 404 /404/index.html;

  <%= @more %>
}
