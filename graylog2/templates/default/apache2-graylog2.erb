#
# Generated by Chef
#

<VirtualHost *:80>
  <% if node[:graylog2][:force_ssl] %>
  <IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://<%= node[:graylog2][:domain_name] || node[:fqdn] %>$1 [R=301,L]
  </IfModule>
  <% else %>
  DocumentRoot <%= node[:graylog2][:basedir] %>/web/public
  <Directory <%= node[:graylog2][:basedir] %>/web/public>
    Allow from all
    Options -MultiViews
  </Directory>
  ErrorLog /var/log/apache2/error.log
  LogLevel warn
  CustomLog /var/log/apache2/access.log combined
  <% end %>
</VirtualHost>

<% if node[:graylog2][:force_ssl] %>
<VirtualHost _default_:443>
  DocumentRoot <%= node[:graylog2][:basedir] %>/web/public
  <Directory <%= node[:graylog2][:basedir] %>/web/public>
    Allow from all
    Options -MultiViews
  </Directory>
  ErrorLog /var/log/apache2/error.log
  LogLevel warn
  CustomLog /var/log/apache2/access.log combined

  SSLEngine on
  SSLCertificateFile <%= "#{node[:apache][:dir]}/ssl/#{node[:graylog2][:domain_name] || node[:fqdn]}.pem" %>
  SSLCertificateKeyFile <%= "#{node[:apache][:dir]}/ssl/#{node[:graylog2][:domain_name] || node[:fqdn]}.key" %>
</VirtualHost>
<% end %>
